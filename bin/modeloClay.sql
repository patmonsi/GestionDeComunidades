DROP TABLE Concepto IF EXISTS;
DROP TABLE NotaInformativa IF EXISTS;
DROP TABLE INMUEBLES IF EXISTS;
DROP TABLE LineaFactura IF EXISTS;
DROP TABLE ReciboInmueble IF EXISTS;
DROP TABLE FACTURA IF EXISTS;
DROP TABLE COMUNIDADES IF EXISTS;
DROP TABLE PROPIETARIOS IF EXISTS;

CREATE TABLE PROPIETARIOS (
       ID_PROPIETARIO INTEGER NOT NULL PRIMARY KEY
     , NIF CHAR(10)
     , NOMBRE CHAR(40)
     , DIRECCION CHAR(40)
     , POBLACION CHAR(40)
     , TELEFONO CHAR(10)
     , OBSERVACIONES CHAR(10)
     , FECHA_ALTA DATE
     , Entidad CHAR(20)
     , NumeroCuenta INTEGER
);

CREATE TABLE COMUNIDADES (
       ID_COMUNIDAD INTEGER NOT NULL
     , CALLE CHAR(40)
     , MAX_RECIBOS_PENDIENTES INTEGER
     , ESTADO CHAR(40)
     , PRESIDENTE OBJECT
     , PRIMARY KEY (ID_COMUNIDAD)
);

CREATE TABLE FACTURA (
       NumFactura INTEGER NOT NULL
     , FechaFactura DATE
     , ID_COMUNIDAD INTEGER
     , PRIMARY KEY (NumFactura)
);

CREATE TABLE ReciboInmueble (
       FechaPago DATE
     , Importe INTEGER
     , ID_INMUEBLE INTEGER NOT NULL
     , ID_Recibo CHAR(10) NOT NULL
     , PRIMARY KEY (ID_Recibo)
);

CREATE TABLE LineaFactura (
       ImporteLinea INTEGER
     , Observacion CHAR(40)
     , NumFactura INTEGER NOT NULL
     , ID_Linea INTEGER NOT NULL
     , PRIMARY KEY (ID_Linea)
);

CREATE TABLE INMUEBLES (
       ID_INMUEBLE INTEGER NOT NULL PRIMARY KEY
     , ESCALERA CHAR(10)
     , PISO CHAR(10)
     , PUERTA CHAR(10)
     , PORCENTAJE FLOAT
     , ID_PROPIETARIO INTEGER
     , ID_COMUNIDAD INTEGER
);

CREATE TABLE NotaInformativa (
       FechaCalculo DATE
     , ImporteNota INTEGER
     , ID_COMUNIDAD INTEGER NOT NULL
     , NumFactura INTEGER NOT NULL
     , ID_Nota INTEGER NOT NULL
     , ID_Recibo CHAR(10) NOT NULL
     , PRIMARY KEY (ID_Nota)
);

CREATE TABLE Concepto (
       ClaveConcepto INTEGER NOT NULL
     , Descripcion CHAR(40)
     , ID_Linea INTEGER NOT NULL
     , PRIMARY KEY (ClaveConcepto)
);

ALTER TABLE FACTURA
  ADD CONSTRAINT FK_FACTURA_1
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDADES (ID_COMUNIDAD);

ALTER TABLE ReciboInmueble
  ADD CONSTRAINT FK_ReciboInmueble_1
      FOREIGN KEY (ID_INMUEBLE)
      REFERENCES INMUEBLES (ID_INMUEBLE);

ALTER TABLE LineaFactura
  ADD CONSTRAINT FK_LineaFactura_1
      FOREIGN KEY (NumFactura)
      REFERENCES FACTURA (NumFactura)
   ON DELETE CASCADE;

ALTER TABLE INMUEBLES
  ADD CONSTRAINT FK_INMUEBLES_1
      FOREIGN KEY (ID_PROPIETARIO)
      REFERENCES PROPIETARIOS (ID_PROPIETARIO);

ALTER TABLE INMUEBLES
  ADD CONSTRAINT FK_INMUEBLES_2
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDADES (ID_COMUNIDAD)
   ON DELETE CASCADE;

ALTER TABLE NotaInformativa
  ADD CONSTRAINT FK_NotaInformativa_1
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDADES (ID_COMUNIDAD);

ALTER TABLE NotaInformativa
  ADD CONSTRAINT FK_NotaInformativa_2
      FOREIGN KEY (NumFactura)
      REFERENCES FACTURA (NumFactura);

ALTER TABLE NotaInformativa
  ADD CONSTRAINT FK_NotaInformativa_3
      FOREIGN KEY (ID_Recibo)
      REFERENCES ReciboInmueble (ID_Recibo)
   ON DELETE CASCADE;

ALTER TABLE Concepto
  ADD CONSTRAINT FK_Concepto_1
      FOREIGN KEY (ID_Linea)
      REFERENCES LineaFactura (ID_Linea);

